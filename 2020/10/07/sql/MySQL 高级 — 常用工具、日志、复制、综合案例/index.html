<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>MySQL 高级 — 常用工具、日志、复制、综合案例 | HJ 的学习录</title><meta name="keywords" content="MySQL"><meta name="author" content="阿健君"><meta name="copyright" content="阿健君"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="MySQL 中常用工具mysql该 mysql 不是指 mysql 服务，而是指 mysql 的客户端工具。语法 ： SHELL1mysql [options] [database]连接选项SHELL1234567891011参数 ：    -u, –user=name            指定用户名    -p, –password[=name]    指定密码    -h, –host=na">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL 高级 — 常用工具、日志、复制、综合案例">
<meta property="og:url" content="http://example.com/2020/10/07/sql/MySQL%20%E9%AB%98%E7%BA%A7%20%E2%80%94%20%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7%E3%80%81%E6%97%A5%E5%BF%97%E3%80%81%E5%A4%8D%E5%88%B6%E3%80%81%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/index.html">
<meta property="og:site_name" content="HJ 的学习录">
<meta property="og:description" content="MySQL 中常用工具mysql该 mysql 不是指 mysql 服务，而是指 mysql 的客户端工具。语法 ： SHELL1mysql [options] [database]连接选项SHELL1234567891011参数 ：    -u, –user=name            指定用户名    -p, –password[=name]    指定密码    -h, –host=na">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/zhangc233/pic@master/img/mysql2.png">
<meta property="article:published_time" content="2020-10-07T13:21:21.000Z">
<meta property="article:modified_time" content="2020-10-07T13:21:21.000Z">
<meta property="article:author" content="阿健君">
<meta property="article:tag" content="MySQL">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/zhangc233/pic@master/img/mysql2.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2020/10/07/sql/MySQL%20%E9%AB%98%E7%BA%A7%20%E2%80%94%20%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7%E3%80%81%E6%97%A5%E5%BF%97%E3%80%81%E5%A4%8D%E5%88%B6%E3%80%81%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'MySQL 高级 — 常用工具、日志、复制、综合案例',
  isPost: true,
  isHome: false,
  isHighlightShrink: true,
  isToc: true,
  postUpdate: '2020-10-07 21:21:21'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/scollbar.css"><link rel="stylesheet" href="/css/bottomsetting.css"><link rel="stylesheet" href="/css/card_categor_hide.css"><link rel="stylesheet" href="/css/article_bak_transparent.css"><link rel="stylesheet" href="/css/index_tag.css"><link rel="stylesheet" href="/css/index_tag2.css"><link rel="stylesheet" href="/css/modify.css"><link rel="stylesheet" href="/css/index_tag3.css"><meta name="generator" content="Hexo 5.4.1"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="wizard-scene"><div class="wizard-objects"><div class="wizard-square"></div><div class="wizard-circle"></div><div class="wizard-triangle"></div></div><div class="wizard"><div class="wizard-body"></div><div class="wizard-right-arm"><div class="wizard-right-hand"></div></div><div class="wizard-left-arm"><div class="wizard-left-hand"></div></div><div class="wizard-head"><div class="wizard-beard"></div><div class="wizard-face"><div class="wizard-adds"></div></div><div class="wizard-hat"><div class="wizard-hat-of-the-hat"></div><div class="wizard-four-point-star --first"></div><div class="wizard-four-point-star --second"></div><div class="wizard-four-point-star --third"></div></div></div></div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">64</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">108</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">23</div></a></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa-fw fas fa-book"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa-fw fas fa-th-large"></i><span> 百宝箱</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="//"><i class="fa-fw fa-fw fas fa-user-shield"></i><span> 评论管理</span></a></li><li><a class="site-page child" href="//"><i class="fa-fw fa-fw fas fa-cloud"></i><span> 我的云盘</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa-fw fas fa-photo-video"></i><span> 生活</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 相册</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa-fw fas fa-child"></i><span> 社交</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/fcircle/"><i class="fa-fw fa-fw fas fa-user-friends"></i><span> 朋友圈</span></a></li><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa-fw fas fa-comments"></i><span> 留言板</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.jsdelivr.net/gh/zhangc233/pic@master/img/mysql2.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">HJ 的学习录</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa-fw fas fa-book"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa-fw fas fa-th-large"></i><span> 百宝箱</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="//"><i class="fa-fw fa-fw fas fa-user-shield"></i><span> 评论管理</span></a></li><li><a class="site-page child" href="//"><i class="fa-fw fa-fw fas fa-cloud"></i><span> 我的云盘</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa-fw fas fa-photo-video"></i><span> 生活</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 相册</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa-fw fas fa-child"></i><span> 社交</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/fcircle/"><i class="fa-fw fa-fw fas fa-user-friends"></i><span> 朋友圈</span></a></li><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa-fw fas fa-comments"></i><span> 留言板</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">MySQL 高级 — 常用工具、日志、复制、综合案例</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2020-10-07T13:21:21.000Z" title="发表于 2020-10-07 21:21:21">2020-10-07</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2020-10-07T13:21:21.000Z" title="更新于 2020-10-07 21:21:21">2020-10-07</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/MySQL/">MySQL</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="MySQL 高级 — 常用工具、日志、复制、综合案例"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><div class="top-img" style="background-image: url('https://cdn.jsdelivr.net/gh/zhangc233/pic@master/img/mysql2.png');"></div><article class="post-content" id="article-container"><p>MySQL 中常用工具<br>mysql<br>该 mysql 不是指 mysql 服务，而是指 mysql 的客户端工具。语法 ：</p>
<p>SHELL<br>1<br>mysql [options] [database]<br>连接选项<br>SHELL<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>参数 ：<br>    -u, –user=name            指定用户名<br>    -p, –password[=name]    指定密码<br>    -h, –host=name            指定服务器IP或域名<br>    -P, –port=#            指定连接端口</p>
<p>示例 ：<br>    mysql -h 127.0.0.1 -P 3306 -u root -p</p>
<pre><code>mysql -h127.0.0.1 -P3306 -uroot -p123456
</code></pre>
<p>执行选项<br>CODE<br>1<br>-e, –execute=name        执行SQL语句并退出<br>此选项可以在 MySQL 客户端执行 SQL 语句，而不用连接到 MySQL 数据库再执行，对于一些批处理脚本，这种方式尤其方便。</p>
<p>SHELL<br>1<br>示例：mysql -uroot -p123456 test -e “select * from tb_book”;</p>
<p>image-20210519192733031<br>mysqladmin<br>mysqladmin 是一个执行管理操作的客户端程序。可以用它来检查服务器的配置和当前状态、创建并删除数据库等。</p>
<p>可以通过 ： mysqladmin –help 指令查看帮助文档 。</p>
<p>SHELL<br>1<br>2<br>3<br>4<br>5<br>示例 ：<br>    mysqladmin -uroot -p123456 create ‘test01’;<br>    mysqladmin -uroot -p123456 drop ‘test01’;<br>    mysqladmin -uroot -p123456 version;</p>
<p>image-20210519193244305<br>mysqlbinlog<br>由于服务器生成的二进制日志文件以二进制格式保存，所以如果想要检查这些文本的文本格式，就会使用到 mysqlbinlog 日志管理工具。</p>
<p>语法 ：</p>
<p>SHELL<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>mysqlbinlog [options]  log-files1 log-files2 …</p>
<p>选项：</p>
<pre><code>-d, --database=name : 指定数据库名称，只列出指定的数据库相关操作。

-o, --offset=# : 忽略掉日志中的前n行命令。

-r,--result-file=name : 将输出的文本格式日志输出到指定文件。

-s, --short-form : 显示简单格式， 省略掉一些信息。

--start-datatime=date1  --stop-datetime=date2 : 指定日期间隔内的所有日志。

--start-position=pos1 --stop-position=pos2 : 指定位置间隔内的所有日志。
</code></pre>
<p>mysqldump<br>mysqldump 客户端工具用来备份数据库或在不同数据库之间进行数据迁移。备份内容包含创建表，及插入表的 SQL 语句。</p>
<p>语法 ：</p>
<p>SHELL<br>1<br>2<br>3<br>4<br>5<br>mysqldump [options] db_name [tables]</p>
<p>mysqldump [options] –database/-B db1 [db2 db3…]</p>
<p>mysqldump [options] –all-databases/-A<br>连接选项<br>CODE<br>1<br>2<br>3<br>4<br>5<br>参数 ：<br>    -u, –user=name            指定用户名<br>    -p, –password[=name]    指定密码<br>    -h, –host=name            指定服务器IP或域名<br>    -P, –port=#            指定连接端口<br>输出内容选项<br>CODE<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>参数：<br>    –add-drop-database        在每个数据库创建语句前加上 Drop database 语句<br>    –add-drop-table        在每个表创建语句前加上 Drop table 语句 , 默认开启 ; 不开启 (–skip-add-drop-table)</p>
<pre><code>-n, --no-create-db        不包含数据库的创建语句
-t, --no-create-info    不包含数据表的创建语句
-d --no-data            不包含数据

 -T, --tab=name            自动生成两个文件：一个.sql文件，创建表结构的语句；
                         一个.txt文件，数据文件，相当于select into outfile  
</code></pre>
<p>SHELL<br>1<br>2<br>3<br>4<br>示例 ：<br>    mysqldump -uroot -p123456 test tb_book –add-drop-database –add-drop-table &gt; a</p>
<pre><code>mysqldump -uroot -p123456 -T /tmp test city
</code></pre>
<p>mysqlimport/source<br>mysqlimport 是客户端数据导入工具，用来导入 mysqldump 加 -T 参数后导出的文本文件。</p>
<p>语法：</p>
<p>SHELL<br>1<br>mysqlimport [options]  db_name  textfile1  [textfile2…]<br>SHELL<br>1<br>示例：mysqlimport -uroot -p123456 test /tmp/city.txt<br>如果需要导入 sql 文件，可以使用 mysql 中的 source 指令 :</p>
<p>SH<br>1<br>source /root/tb_book.sql<br>mysqlshow<br>mysqlshow 客户端对象查找工具，用来很快地查找存在哪些数据库、数据库中的表、表中的列或者索引。</p>
<p>语法：</p>
<p>CODE<br>1<br>mysqlshow [options] [db_name [table_name [col_name]]]<br>参数：</p>
<p>CODE<br>1<br>2<br>3<br>–count        显示数据库及表的统计信息（数据库，表 均可以不指定）</p>
<p>-i            显示指定数据库或者指定表的状态信息<br>示例：</p>
<p>SHELL<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>#查询每个数据库的表的数量及表中记录的数量<br>mysqlshow -uroot -p123456 –count</p>
<p>#查询test库中每个表中的字段书，及行数<br>mysqlshow -uroot -p123456 test –count</p>
<p>#查询test库中book表的详细情况<br>mysqlshow -uroot -p123456 test book –count</p>
<p>image-20210519192733031</p>
<p>image-20210519192627476<br>MySQL 日志<br>在任何一种数据库中，都会有各种各样的日志，记录着数据库工作的方方面面，以帮助数据库管理员追踪数据库曾经发生过的各种事件。MySQL 也不例外，在 MySQL 中，有 4 种不同的日志，分别是错误日志、二进制日志（BINLOG 日志）、查询日志和慢查询日志，这些日志记录着数据库在不同方面的踪迹。</p>
<p>错误日志<br>错误日志是 MySQL 中最重要的日志之一，它记录了当 mysqld 启动和停止时，以及服务器在运行过程中发生任何严重错误时的相关信息。当数据库出现任何故障导致无法正常使用时，可以首先查看此日志。该日志是默认开启的 ， 默认存放目录为 mysql 的数据目录，默认的日志文件名为 hostname.err（hostname 是主机名）。</p>
<p>查看日志位置指令 ：</p>
<p>SQL<br>1<br>show variables like ‘log_error%’;<br>SQL<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>mysql&gt; show variables like ‘log_error%’;<br>+———————+———————–+<br>| Variable_name       | Value                 |<br>+———————+———————–+<br>| log_error           | .\LAPTOP-6SEJGOUJ.err |<br>| log_error_verbosity | 3                     |<br>+———————+———————–+<br>2 rows in set (0.09 sec)<br>二进制日志<br>概述<br>二进制日志（BINLOG）记录了所有的 DDL（数据定义语言）语句和 DML（数据操纵语言）语句，但是不包括数据查询语句。此日志对于灾难时的数据恢复起着极其重要的作用，MySQL 的主从复制， 就是通过该 binlog 实现的。二进制日志，默认情况下是没有开启的，需要到 MySQL 的配置文件中开启，并配置 MySQL 日志的格式。</p>
<p>配置文件位置：配置时，给定了文件名但是没有指定路径，日志默认写入 MySQL 的数据目录：</p>
<p>Windows：C:\ProgramData\MySQL\MySQL Server 5.7\my.ini</p>
<p>Linux：/usr/my.cnf</p>
<p>XML<br>1<br>2<br>3<br>4<br>5<br>#配置开启binlog日志， 日志的文件前缀为 mysqlbin —–&gt; 生成的文件名如 : mysqlbin.000001,mysqlbin.000002<br>log_bin=mysqlbin</p>
<p>#配置二进制日志的格式<br>binlog_format=STATEMENT<br>日志格式<br>STATEMENT</p>
<p>该日志格式在日志文件中记录的都是 SQL 语句（statement），每一条对数据进行修改的 SQL 都会记录在日志文件中，通过 MySQL 提供的 mysqlbinlog 工具，可以清晰的查看到每条语句的文本。主从复制的时候，从库（slave）会将日志解析为原文本，并在从库重新执行一次。</p>
<p>ROW</p>
<p>该日志格式在日志文件中记录的是每一行的数据变更，而不是记录 SQL 语句。比如，执行 SQL 语句 ： update tb_book set status=’1’ , 如果是 STATEMENT 日志格式，在日志中会记录一行 SQL 文件； 如果是 ROW，由于是对全表进行更新，也就是每一行记录都会发生变更，ROW 格式的日志中会记录每一行的数据变更。</p>
<p>MIXED</p>
<p>这是目前 MySQL 默认的日志格式，即混合了 STATEMENT 和 ROW 两种格式。默认情况下采用 STATEMENT，但是在一些特殊情况下采用 ROW 来进行记录。MIXED 格式能尽量利用两种模式的优点，而避开他们的缺点。</p>
<p>日志读取<br>由于日志以二进制方式存储，不能直接读取，需要用 mysqlbinlog 工具来查看，语法如下 ：</p>
<p>SHELL<br>1<br>mysqlbinlog log-file；<br>查看 STATEMENT 格式日志</p>
<p>执行插入语句 ：</p>
<p>SQL<br>1<br>insert into tb_book values(null,’Lucene’,’2088-05-01’,’0’);<br>查看日志文件 ：</p>
<p>image-20210519192007729<br>mysqlbin.index : 该文件是日志索引文件 ， 记录日志的文件名；而 mysqlbing.000001 ：日志文件。</p>
<p>查看日志内容 ：</p>
<p>SHELL<br>1<br>mysqlbinlog mysqlbing.000001;</p>
<p>1554080016778<br>查看 ROW 格式日志</p>
<p>配置 :</p>
<p>CODE<br>1<br>2<br>3<br>4<br>5<br>#配置开启binlog日志， 日志的文件前缀为 mysqlbin —–&gt; 生成的文件名如 : mysqlbin.000001,mysqlbin.000002<br>log_bin=mysqlbin</p>
<p>#配置二进制日志的格式<br>binlog_format=ROW<br>插入数据 :</p>
<p>SQL<br>1<br>insert into tb_book values(null,’SpringCloud实战’,’2088-05-05’,’0’);<br>如果日志格式是 ROW , 直接查看数据，是看不懂的；可以在 mysqlbinlog 后面加上参数 -vv</p>
<p>SQL<br>1<br>mysqlbinlog -vv mysqlbin.000002 </p>
<p>1554095452022<br>日志删除<br>对于比较繁忙的系统，由于每天生成日志量大 ，这些日志如果长时间不清楚，将会占用大量的磁盘空间。下面我们将会讲解几种删除日志的常见方法 ：</p>
<p>方式一</p>
<p>通过 Reset Master 指令删除全部 binlog 日志，删除之后，日志编号，将从 xxxx.000001 重新开始 。</p>
<p>执行删除日志指令：</p>
<p>SHELL<br>1<br>Reset Master<br>方式二</p>
<p>执行指令 purge master logs to ‘mysqlbin.******’ ，该命令将删除 ****** 编号之前的所有日志。</p>
<p>方式三</p>
<p>执行指令 purge master logs before ‘yyyy-mm-dd hh24:mi:ss’ ，该命令将删除日志为 “yyyy-mm-dd hh24:mi:ss” 之前产生的所有日志 。</p>
<p>方式四</p>
<p>设置参数 –expire_logs_days=# ，此参数的含义是设置日志的过期天数， 过了指定的天数后日志将会被自动删除，这样将有利于减少 DBA 管理日志的工作量。</p>
<p>配置如下 ：</p>
<p>XML<br>1<br>2<br>3<br>4<br>5<br>log_bin=mysqlbin</p>
<p>binlog_format=ROW</p>
<p>expire_logs_days=3<br>查询日志<br>查询日志中记录了客户端的所有操作语句，而二进制日志不包含查询数据的 SQL 语句。默认情况下， 查询日志是未开启的。如果需要开启查询日志，可以设置以下配置 ：</p>
<p>XML<br>1<br>2<br>3<br>4<br>5<br>#该选项用来开启查询日志 ， 可选值 ： 0 或者 1 ； 0 代表关闭， 1 代表开启<br>general_log=1</p>
<p>#设置日志的文件名 ， 如果没有指定， 默认的文件名为 host_name.log<br>general_log_file=file_name<br>在 mysql 的配置文件中配置如下内容 ：</p>
<p>XML<br>1<br>2<br>3<br>4<br>5<br>#开启查询日志<br>general-log=1</p>
<p>#配置查询日志的文件名<br>general_log_file=”mysql_query.log”<br>配置完毕之后，在数据库执行以下操作 ：</p>
<p>SQL<br>1<br>2<br>3<br>4<br>select * from tb_book;<br>select * from tb_book where id = 1;<br>update tb_book set name = ‘lucene入门指南’ where id = 5;<br>select * from tb_book where id &lt; 8;<br>执行完毕之后， 再次来查询日志文件 ：</p>
<p>CODE<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>C:\Program Files\MySQL\MySQL Server 5.7\bin\mysqld.exe, Version: 5.7.32-log (MySQL Community Server (GPL)). started with:<br>TCP Port: 3306, Named Pipe: (null)<br>Time                 Id Command    Argument<br>2021-05-19T12:19:36.603915Z        2 Connect    root@localhost on test using TCP/IP<br>2021-05-19T12:19:36.604924Z        2 Query    SET NAMES utf8mb4<br>2021-05-19T12:19:36.605342Z        2 Init DB    test<br>2021-05-19T12:19:36.607604Z        2 Query    select * from tb_book<br>2021-05-19T12:19:36.779978Z        2 Init DB    test<br>2021-05-19T12:19:36.780489Z        2 Query    select * from tb_book where id = 1<br>2021-05-19T12:19:36.919822Z        2 Init DB    test<br>2021-05-19T12:19:36.956204Z        2 Query    update tb_book set name = ‘lucene入门指南’ where id = 5<br>2021-05-19T12:19:37.017167Z        2 Init DB    test<br>2021-05-19T12:19:37.017970Z        2 Query    select * from tb_book where id &lt; 8<br>慢查询日志<br>慢查询日志记录了所有执行时间超过参数 long_query_time 设置值并且扫描记录数不小于 min_examined_row_limit 的所有的 SQL 语句的日志。long_query_time 默认为 10 秒，最小为 0， 精度可以到微秒。</p>
<p>文件位置和格式<br>慢查询日志默认是关闭的 。可以通过两个参数来控制慢查询日志 ：</p>
<p>XML<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8</p>
<h1 id="该参数用来控制慢查询日志是否开启，-可取值：-1-和-0-，-1-代表开启，-0-代表关闭"><a href="#该参数用来控制慢查询日志是否开启，-可取值：-1-和-0-，-1-代表开启，-0-代表关闭" class="headerlink" title="该参数用来控制慢查询日志是否开启， 可取值： 1 和 0 ， 1 代表开启， 0 代表关闭"></a>该参数用来控制慢查询日志是否开启， 可取值： 1 和 0 ， 1 代表开启， 0 代表关闭</h1><p>slow_query_log=1 </p>
<h1 id="该参数用来指定慢查询日志的文件名"><a href="#该参数用来指定慢查询日志的文件名" class="headerlink" title="该参数用来指定慢查询日志的文件名"></a>该参数用来指定慢查询日志的文件名</h1><p>slow_query_log_file=slow_query.log</p>
<h1 id="该选项用来配置查询的时间限制，-超过这个时间将认为值慢查询，-将需要进行日志记录，-默认10s"><a href="#该选项用来配置查询的时间限制，-超过这个时间将认为值慢查询，-将需要进行日志记录，-默认10s" class="headerlink" title="该选项用来配置查询的时间限制， 超过这个时间将认为值慢查询， 将需要进行日志记录， 默认10s"></a>该选项用来配置查询的时间限制， 超过这个时间将认为值慢查询， 将需要进行日志记录， 默认10s</h1><p>long_query_time=10<br>日志的读取<br>和错误日志、查询日志一样，慢查询日志记录的格式也是纯文本，可以被直接读取。</p>
<p>1） 查询 long_query_time 的值。</p>
<p>SQL<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>mysql&gt; show variables like ‘long%’;<br>+—————–+———–+<br>| Variable_name   | Value     |<br>+—————–+———–+<br>| long_query_time | 10.000000 |<br>+—————–+———–+<br>1 row in set (0.13 sec)<br>2） 执行查询操作</p>
<p>SQL<br>1<br>select * from tb_item where id = 1;<br>由于该语句执行时间很短，为 0s ， 所以不会记录在慢查询日志中。</p>
<p>SQL<br>1<br>select * from tb_item where title like ‘%阿尔卡特 (OT-927) 炭黑 联通3G手机 双卡双待165454%’ ;</p>
<p>1554130532577<br>该 SQL 语句 ， 执行时长为 26.77s ，超过 10s ， 所以会记录在慢查询日志文件中。</p>
<p>3） 查看慢查询日志文件</p>
<p>直接查询该日志文件 ：</p>
<p>image-20210519203330362<br>如果慢查询日志内容很多， 直接查看文件，比较麻烦， 这个时候可以借助于 mysql 自带的 mysqldumpslow 工具， 来对慢查询日志进行分类汇总。</p>
<p>image-20210519203426832<br>MySQL 复制<br>复制概述<br>复制是指将主数据库的 DDL 和 DML 操作通过二进制日志传到从库服务器中，然后在从库上对这些日志重新执行（也叫重做），从而使得从库和主库的数据保持同步。</p>
<p>MySQL 支持一台主库同时向多台从库进行复制， 从库同时也可以作为其他从服务器的主库，实现链状复制。</p>
<p>复制原理<br>MySQL 的主从复制原理如下。</p>
<p>image-20210519203834829<br>从上层来看，复制分成三步：</p>
<p>Master 主库在事务提交时，会把数据变更作为时间 Events 记录在二进制日志文件 Binlog 中。</p>
<p>主库推送二进制日志文件 Binlog 中的日志事件到从库的中继日志 Relay Log 。</p>
<p>slave 重做中继日志中的事件，将改变反映给它自己的数据。</p>
<p>复制优势<br>MySQL 复制的优点主要包含以下三个方面：</p>
<p>主库出现问题，可以快速切换到从库提供服务。</p>
<p>可以在从库上执行查询操作，从主库中更新，实现读写分离，降低主库的访问压力。</p>
<p>可以在从库中执行备份，以避免备份期间影响主库的服务。</p>
<p>搭建步骤<br>master<br>1） 在 master 的配置文件（/usr/my.cnf 或者 my.ini）中，配置如下内容：</p>
<p>PROPERTIES<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>#mysql 服务ID,保证整个集群环境中唯一<br>server-id=1</p>
<p>#mysql binlog 日志的存储路径和文件名 下面以Linux系统为例<br>log-bin=/var/lib/mysql/mysqlbin </p>
<p>#错误日志,默认已经开启<br>#log-err</p>
<p>#mysql的安装目录<br>#basedir</p>
<p>#mysql的临时目录<br>#tmpdir</p>
<p>#mysql的数据存放目录<br>#datadir</p>
<p>#是否只读,1 代表只读, 0 代表读写<br>read-only=0</p>
<p>#忽略的数据, 指不需要同步的数据库<br>binlog-ignore-db=mysql</p>
<p>#指定同步的数据库<br>#binlog-do-db=db01<br>2） 执行完毕之后，需要重启 Mysql：</p>
<p>CODE<br>1<br>service mysql restart ;<br>3） 创建同步数据的账户，并且进行授权操作：</p>
<p>SQL<br>1<br>2<br>3<br>grant replication slave on <em>.</em> to ‘mysql‘@’192.168.192.131’ identified by ‘mysql’;    </p>
<p>flush privileges;<br>4） 查看 master 状态：</p>
<p>SQL<br>1<br>show master status;</p>
<p>1554477759735<br>字段含义：</p>
<p>CODE<br>1<br>2<br>3<br>File : 从哪个日志文件开始推送日志文件<br>Position ： 从哪个位置开始推送日志<br>Binlog_Ignore_DB : 指定不需要同步的数据库<br>slave<br>1） 在 slave 端配置文件中，配置如下内容：</p>
<p>PROPERTIES<br>1<br>2<br>3<br>4<br>5<br>#mysql服务端ID,唯一<br>server-id=2</p>
<p>#指定binlog日志<br>log-bin=/var/lib/mysql/mysqlbin<br>2） 执行完毕之后，需要重启 Mysql：</p>
<p>CODE<br>1<br>service mysql restart;<br>3） 执行如下指令 ：</p>
<p>SQL<br>1<br>change master to master_host= ‘192.168.192.130’, master_user=’mysql’, master_password=’123456’, master_log_file=’mysqlbin.000001’, master_log_pos=413;<br>指定当前从库对应的主库的 IP 地址，用户名，密码，从哪个日志文件开始的那个位置开始同步推送日志。</p>
<p>4） 开启同步操作</p>
<p>CODE<br>1<br>2<br>3<br>start slave;</p>
<p>show slave status;</p>
<p>image-20210519204321826<br>5） 停止同步操作</p>
<p>CODE<br>1<br>stop slave;<br>验证同步操作<br>1） 在主库中创建数据库，创建表，并插入数据 ：</p>
<p>SQL<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>create database db01;</p>
<p>user db01;</p>
<p>create table user(<br>    id int(11) not null auto_increment,<br>    name varchar(50) not null,<br>    sex varchar(1),<br>    primary key (id)<br>)engine=innodb default charset=utf8;</p>
<p>insert into user(id,name,sex) values(null,’Tom’,’1’);<br>insert into user(id,name,sex) values(null,’Trigger’,’0’);<br>insert into user(id,name,sex) values(null,’Dawn’,’1’);<br>2） 在从库中查询数据，进行验证 ：</p>
<p>在从库中，可以查看到刚才创建的数据库：</p>
<p>1554544658640<br>在该数据库中，查询 user 表中的数据：</p>
<p>1554544679538<br>综合案例<br>需求分析<br>在业务系统中，需要记录当前业务系统的访问日志，该访问日志包含：操作人，操作时间，访问类，访问方法，请求参数，请求结果，请求结果类型，请求时长 等信息。记录详细的系统访问日志，主要便于对系统中的用户请求进行追踪，并且在系统 的管理后台可以查看到用户的访问记录。</p>
<p>记录系统中的日志信息，可以通过 Spring 框架的 AOP 来实现。具体的请求处理流程，如下：</p>
<p>image-20210523213639350</p>
<p>搭建案例环境<br>数据库表<br>SQL<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br>40<br>41<br>42<br>43<br>44<br>45<br>46<br>47<br>48<br>49<br>50<br>51<br>52<br>53<br>CREATE DATABASE mysql_demo DEFAULT CHARACTER SET utf8mb4 ；</p>
<p>CREATE TABLE <code>brand</code> (<br>  <code>id</code> bigint(20) NOT NULL AUTO_INCREMENT,<br>  <code>name</code> varchar(255) DEFAULT NULL COMMENT ‘品牌名称’,<br>  <code>first_char</code> varchar(1) DEFAULT NULL COMMENT ‘品牌首字母’,<br>  PRIMARY KEY (<code>id</code>)<br>) ENGINE=InnoDB DEFAULT CHARSET=utf8;</p>
<p>CREATE TABLE <code>item</code> (<br>  <code>id</code> int(11) NOT NULL AUTO_INCREMENT COMMENT ‘商品id’,<br>  <code>title</code> varchar(100) NOT NULL COMMENT ‘商品标题’,<br>  <code>price</code> double(10,2) NOT NULL COMMENT ‘商品价格，单位为：元’,<br>  <code>num</code> int(10) NOT NULL COMMENT ‘库存数量’,<br>  <code>categoryid</code> bigint(10) NOT NULL COMMENT ‘所属类目，叶子类目’,<br>  <code>status</code> varchar(1) DEFAULT NULL COMMENT ‘商品状态，1-正常，2-下架，3-删除’,<br>  <code>sellerid</code> varchar(50) DEFAULT NULL COMMENT ‘商家ID’,<br>  <code>createtime</code> datetime DEFAULT NULL COMMENT ‘创建时间’,<br>  <code>updatetime</code> datetime DEFAULT NULL COMMENT ‘更新时间’,<br>  PRIMARY KEY (<code>id</code>)<br>) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT=’商品表’;</p>
<p>CREATE TABLE <code>user</code> (<br>  <code>id</code> int(11) NOT NULL AUTO_INCREMENT,<br>  <code>username</code> varchar(45) NOT NULL,<br>  <code>password</code> varchar(96) NOT NULL,<br>  <code>name</code> varchar(45) NOT NULL,<br>  <code>birthday</code> datetime DEFAULT NULL,<br>  <code>sex</code> char(1) DEFAULT NULL,<br>  <code>email</code> varchar(45) DEFAULT NULL,<br>  <code>phone</code> varchar(45) DEFAULT NULL,<br>  <code>qq</code> varchar(32) DEFAULT NULL,<br>  PRIMARY KEY (<code>id</code>)<br>) ENGINE=InnoDB DEFAULT CHARSET=utf8;</p>
<p>CREATE TABLE <code>operation_log</code> (<br>  <code>id</code> bigint(20) NOT NULL AUTO_INCREMENT COMMENT ‘ID’,<br>  <code>operate_class</code> varchar(200) DEFAULT NULL COMMENT ‘操作类’,<br>  <code>operate_method</code> varchar(200) DEFAULT NULL COMMENT ‘操作方法’,<br>  <code>return_class</code> varchar(200) DEFAULT NULL COMMENT ‘返回值类型’,<br>  <code>operate_user</code> varchar(20) DEFAULT NULL COMMENT ‘操作用户’,<br>  <code>operate_time</code> varchar(20) DEFAULT NULL COMMENT ‘操作时间’,<br>  <code>param_and_value</code> varchar(500) DEFAULT NULL COMMENT ‘请求参数名及参数值’,<br>  <code>cost_time</code> bigint(20) DEFAULT NULL COMMENT ‘执行方法耗时, 单位 ms’,<br>  <code>return_value</code> varchar(200) DEFAULT NULL COMMENT ‘返回值’,<br>  PRIMARY KEY (<code>id</code>)<br>) ENGINE=InnoDB  DEFAULT CHARSET=utf8mb4;</p>
<pre><code class="bash">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:mvc="http://www.springframework.org/schema/mvc"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
            http://www.springframework.org/schema/beans/spring-beans.xsd
            http://www.springframework.org/schema/mvc
            http://www.springframework.org/schema/mvc/spring-mvc.xsd
            http://www.springframework.org/schema/aop
            http://www.springframework.org/schema/aop/spring-aop.xsd
            http://www.springframework.org/schema/context
            http://www.springframework.org/schema/context/spring-context.xsd"&gt;

    &lt;context:component-scan base-package="cn.itcast.controller"&gt;&lt;/context:component-scan&gt;

    &lt;mvc:annotation-driven&gt;&lt;/mvc:annotation-driven&gt;

    &lt;aop:aspectj-autoproxy /&gt;

&lt;/beans&gt;
</code></pre>
<p>导入基础工程</p>
<p>image-20210523213609159</p>
<p>通过 AOP 记录操作日志<br>自定义注解<br>通过自定义注解，来标示方法需不需要进行记录日志，如果该方法在访问时需要记录日志，则在该方法上标示该注解既可。</p>
<pre><code>@Inherited
@Documented
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface OperateLog {
}
</code></pre>
<p>定义通知类</p>
<pre><code class="bash">@Component
@Aspect
public class OperateAdvice {
   
   private static Logger log = Logger.getLogger(OperateAdvice.class);
   
   @Autowired
   private OperationLogService operationLogService;
   

   @Around("execution(* cn.itcast.controller.*.*(..)) &amp;&amp; @annotation(operateLog)")
   public Object insertLogAround(ProceedingJoinPoint pjp , OperateLog operateLog) throws Throwable{
      System.out.println(" ************************ 记录日志 [start]  ****************************** ");
      
      OperationLog op = new OperationLog();
      
      DateFormat sdf = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");

      op.setOperateTime(sdf.format(new Date()));
      op.setOperateUser(DataUtils.getRandStr(8));
      
      op.setOperateClass(pjp.getTarget().getClass().getName());
      op.setOperateMethod(pjp.getSignature().getName());
      
      //获取方法调用时传递的参数
      Object[] args = pjp.getArgs();
      op.setParamAndValue(Arrays.toString(args));

      long start_time = System.currentTimeMillis();

      //放行
      Object object = pjp.proceed();

      long end_time = System.currentTimeMillis();
      op.setCostTime(end_time - start_time);

      if(object != null){
         op.setReturnClass(object.getClass().getName());
         op.setReturnValue(object.toString());
      }else{
         op.setReturnClass("java.lang.Object");
         op.setParamAndValue("void");
      }

      log.error(JsonUtils.obj2JsonString(op));

      operationLogService.insert(op);
      
      System.out.println(" ************************** 记录日志 [end]  *************************** ");
      
      return object;
   }
   
}
</code></pre>
<p>方法上加注解<br>在需要记录日志的方法上加上注解 @OperateLog。</p>
<pre><code class="bash">@OperateLog
@RequestMapping("/insert")
public Result insert(@RequestBody Brand brand){
    try {
        brandService.insert(brand);
        return new Result(true,"操作成功");
    } catch (Exception e) {
        e.printStackTrace();
        return new Result(false,"操作失败");
    }
}
</code></pre>
<p>日志查询后端代码实现<br>Mapper 接口</p>
<pre><code class="bash">public interface OperationLogMapper {

    public void insert(OperationLog operationLog);

    public List&lt;OperationLog&gt; selectListByCondition(Map dataMap);

    public Long countByCondition(Map dataMap);

}
</code></pre>
<p>Mapper.xml 映射配置文件</p>
<pre><code class="bash">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" &gt;
&lt;mapper namespace="cn.itcast.mapper.OperationLogMapper" &gt;

    &lt;insert id="insert" parameterType="operationLog"&gt;
        INSERT INTO operation_log(id,return_value,return_class,operate_user,operate_time,param_and_value,
        operate_class,operate_method,cost_time)
      VALUES(NULL,#{returnValue},#{returnClass},#{operateUser},#{operateTime},#{paramAndValue},
        #{operateClass},#{operateMethod},#{costTime})
    &lt;/insert&gt;

    &lt;select id="selectListByCondition" parameterType="map" resultType="operationLog"&gt;
      select
        id ,
        operate_class as operateClass ,
        operate_method as operateMethod,
        return_class as returnClass,
        operate_user as operateUser,
        operate_time as operateTime,
        param_and_value as paramAndValue,
        cost_time as costTime,
        return_value as returnValue
      from operation_log
      &lt;include refid="oplog_where"/&gt;
      limit #{start},#{size}
    &lt;/select&gt;


    &lt;select id="countByCondition" resultType="long" parameterType="map"&gt;
        select count(*) from operation_log
        &lt;include refid="oplog_where"/&gt;
    &lt;/select&gt;


    &lt;sql id="oplog_where"&gt;
        &lt;where&gt;
            &lt;if test="operateClass != null and operateClass != '' "&gt;
                and operate_class = #{operateClass}
            &lt;/if&gt;
            &lt;if test="operateMethod != null and operateMethod != '' "&gt;
                and operate_method = #{operateMethod}
            &lt;/if&gt;
            &lt;if test="returnClass != null and returnClass != '' "&gt;
                and return_class = #{returnClass}
            &lt;/if&gt;
            &lt;if test="costTime != null"&gt;
                and cost_time =  #{costTime}
            &lt;/if&gt;
        &lt;/where&gt;
    &lt;/sql&gt;

&lt;/mapper&gt;
</code></pre>
<p>Service</p>
<pre><code class="bash">@Service
@Transactional
public class OperationLogService {

    //private static Logger logger = Logger.getLogger(OperationLogService.class);

    @Autowired
    private OperationLogMapper operationLogMapper;

    //插入数据
    public void insert(OperationLog operationLog){
        operationLogMapper.insert(operationLog);
    }

    //根据条件查询
    public PageResult selectListByCondition(Map dataMap, Integer pageNum , Integer pageSize){

       if(paramMap ==null){
            paramMap = new HashMap();
        }
        paramMap.put("start" , (pageNum-1)*rows);
        paramMap.put("rows",rows);

        Object costTime = paramMap.get("costTime");
        if(costTime != null){
            if("".equals(costTime.toString())){
                paramMap.put("costTime",null);
            }else{
                paramMap.put("costTime",new Long(paramMap.get("costTime").toString()));
            }
        }

        System.out.println(dataMap);


        long countStart = System.currentTimeMillis();
        Long count = operationLogMapper.countByCondition(dataMap);
        long countEnd = System.currentTimeMillis();
        System.out.println("Count Cost Time : " + (countEnd-countStart)+" ms");


        List&lt;OperationLog&gt; list = operationLogMapper.selectListByCondition(dataMap);
        long queryEnd = System.currentTimeMillis();
        System.out.println("Query Cost Time : " + (queryEnd-countEnd)+" ms");


        return new PageResult(count,list);

    }

}
</code></pre>
<p>Controller</p>
<pre><code class="bash">@RestController
@RequestMapping("/operationLog")
public class OperationLogController {

    @Autowired
    private OperationLogService operationLogService;

    @RequestMapping("/findList")
    public PageResult findList(@RequestBody Map dataMap, Integer pageNum , Integer pageSize){
        PageResult page = operationLogService.selectListByCondition(dataMap, pageNum, pageSize);
        return page;
    }

}
日志查询前端代码实现
前端代码使用 BootStrap + AdminLTE 进行布局， 使用 Vuejs 进行视图层展示。

```bash
&lt;script&gt;
   var vm = new Vue({
       el: '#app',
       data: {
           dataList:[],
           searchEntity:{
               operateClass:'',
               operateMethod:'',
               returnClass:'',
               costTime:''
           },

           page: 1,  //显示的是哪一页
           pageSize: 10, //每一页显示的数据条数
           total: 150, //记录总数
           maxPage:8  //最大页数
       },
       methods: {
           pageHandler: function (page) {
               this.page = page;
               this.search();
           },

           search: function () {
               var _this = this;
               this.showLoading();
               axios.post('/operationLog/findList.do?pageNum=' + _this.page + "&amp;pageSize=" + _this.pageSize, _this.searchEntity).then(function (response) {
                   if (response) {
                       _this.dataList = response.data.dataList;
                       _this.total = response.data.total;
                       _this.hideLoading();
                   }
               })
           },

           showLoading: function () {
               $('#loadingModal').modal({backdrop: 'static', keyboard: false});
           },

           hideLoading: function () {
               $('#loadingModal').modal('hide');
           },
       },

       created:function(){
           this.pageHandler(1);
       }
   });

&lt;/script&gt;
</code></pre>
<p>列表数据展示</p>
<pre><code class="bash">&lt;tr v-for="item in dataList"&gt;
    &lt;td&gt;&lt;input name="ids" type="checkbox"&gt;&lt;/td&gt;
    &lt;td&gt;{{item.id}}&lt;/td&gt;
    &lt;td&gt;{{item.operateClass}}&lt;/td&gt;
    &lt;td&gt;{{item.operateMethod}}&lt;/td&gt;
    &lt;td&gt;{{item.returnClass}}&lt;/td&gt;
    &lt;td&gt;{{item.returnValue}}&lt;/td&gt;
    &lt;td&gt;{{item.operateUser}}&lt;/td&gt;
    &lt;td&gt;{{item.operateTime}}&lt;/td&gt;
    &lt;td&gt;{{item.costTime}}&lt;/td&gt;
    &lt;td class="text-center"&gt;
        &lt;button type="button" class="btn bg-olive btn-xs"&gt;详情&lt;/button&gt;
        &lt;button type="button" class="btn bg-olive btn-xs"&gt;删除&lt;/button&gt;
    &lt;/td&gt;
&lt;/tr&gt;
</code></pre>
<p>分页插件</p>
<pre><code class="bash">&lt;div class="wrap" id="wrap"&gt;
    &lt;zpagenav v-bind:page="page" v-bind:page-size="pageSize" v-bind:total="total"
              v-bind:max-page="maxPage"  v-on:pagehandler="pageHandler"&gt;
    &lt;/zpagenav&gt;
&lt;/div&gt;
</code></pre>
<p>联调测试<br>可以通过 postman 来访问业务系统，再查看数据库中的日志信息，验证能不能将用户的访问日志记录下来。</p>
<p>image-20210523213448735</p>
<p>分析性能问题<br>系统中用户访问日志的数据量，随着时间的推移，这张表的数据量会越来越大，因此我们需要根据业务需求，来对日志查询模块的性能进行优化。</p>
<p>1） 分页查询优化：由于在进行日志查询时，是进行分页查询，那也就意味着，在查看时，至少需要查询两次：</p>
<p>查询符合条件的总记录数。–&gt; count 操作</p>
<p>查询符合条件的列表数据。–&gt; 分页查询 limit 操作</p>
<p>通常来说，count () 都需要扫描大量的行（意味着需要访问大量的数据）才能获得精确的结果，因此是很难对该 SQL 进行优化操作的。如果需要对 count 进行优化，可以采用另外一种思路，可以增加汇总表，或者 redis 缓存来专门记录该表对应的记录数，这样的话，就可以很轻松的实现汇总数据的查询，而且效率很高，但是这种统计并不能保证百分之百的准确 。对于数据库的操作，“快速、精确、实现简单”，三者永远只能满足其二，必须舍掉其中一个。</p>
<p>2） 条件查询优化：针对于条件查询，需要对查询条件，及排序字段建立索引。</p>
<p>3） 读写分离：通过主从复制集群，来完成读写分离，使写操作走主节点， 而读操作，走从节点。</p>
<p>4） MySQL 服务器优化</p>
<p>5） 应用优化</p>
<p>性能优化 - 分页<br>优化 count<br>创建一张表用来记录日志表的总数据量：</p>
<pre><code class="bash">create table log_counter(
    logcount bigint not null
)engine = innodb default CHARSET = utf8;
</code></pre>
<p>在每次插入数据之后，更新该表 ：</p>
<pre><code class="bash">&lt;update id="updateLogCounter" &gt;
    update log_counter set logcount = logcount + 1
&lt;/update&gt;
在进行分页查询时，获取总记录数，从该表中查询既可。
</code></pre>
<pre><code class="bash">&lt;select id="countLogFromCounter" resultType="long"&gt;
    select logcount from log_counter limit 1
&lt;/select&gt;
</code></pre>
<h2 id="优化-limit"><a href="#优化-limit" class="headerlink" title="优化 limit"></a>优化 limit</h2><p>在进行分页时，一般通过创建覆盖索引，能够比较好的提高性能。一个非常常见，而又非常头疼的分页场景就是 “limit 1000000,10” ，此时 MySQL 需要搜索出前 1000010 条记录后，仅仅需要返回第 1000001 到 1000010 条记录，前 1000000 记录会被抛弃，查询代价非常大。</p>
<p>image-20210523213403564</p>
<p>当点击比较靠后的页码时，就会出现这个问题，查询效率非常慢。</p>
<p>优化 SQL：</p>
<p>SQL<br>1<br>select * from operation_log limit 3000000 , 10;<br>将上述 SQL 优化为 :</p>
<pre><code class="bash">SQL
select * from operation_log t , (select id from operation_log order by id limit 3000000,10) b where t.id = b.id ;
</code></pre>
<pre><code class="bash">&lt;select id="selectListByCondition" parameterType="map" resultType="operationLog"&gt;
  select
    id ,
    operate_class as operateClass ,
    operate_method as operateMethod,
    return_class as returnClass,
    operate_user as operateUser,
    operate_time as operateTime,
    param_and_value as paramAndValue,
    cost_time as costTime,
    return_value as returnValue
  from operation_log t,
    
  (select id from operation_log 
  &lt;where&gt;
    &lt;include refid="oplog_where"/&gt;
  &lt;/where&gt;
  order by id limit #{start},#{rows}) b  where t.id = b.id  
&lt;/select&gt;
</code></pre>
<h2 id="性能优化-索引"><a href="#性能优化-索引" class="headerlink" title="性能优化 - 索引"></a>性能优化 - 索引</h2><p>image-20210523213331621</p>
<p>当根据操作人进行查询时， 查询的效率很低，耗时比较长。原因就是因为在创建数据库表结构时，并没有针对于 操作人 字段建立索引。</p>
<pre><code class="bash">CREATE INDEX idx_user_method_return_cost ON operation_log(operate_user,operate_method,return_class,cost_time);
</code></pre>
<p>同上 ， 为了查询效率高，我们也需要对 操作方法、返回值类型、操作耗时 等字段进行创建索引，以提高查询效率。</p>
<pre><code class="bash">CREATE INDEX idx_optlog_method_return_cost ON operation_log(operate_method,return_class,cost_time);

CREATE INDEX idx_optlog_return_cost ON operation_log(return_class,cost_time);

CREATE INDEX idx_optlog_cost ON operation_log(cost_time);
</code></pre>
<p>性能优化 - 排序<br>在查询数据时，如果业务需求中需要我们对结果内容进行了排序处理，这个时候，我们还需要对排序的字段建立适当的索引，来提高排序的效率 。</p>
<p>性能优化 - 读写分离<br>概述<br>在 MySQL 主从复制的基础上，可以使用读写分离来降低单台 MySQL 节点的压力，从而来提高访问效率，读写分离的架构如下：</p>
<p>image-20210523213306954</p>
<p>对于读写分离的实现，可以通过 Spring AOP 来进行动态的切换数据源，进行操作 ：</p>
<p>实现方式<br>db.properties：</p>
<p>PROPERTIES<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>jdbc.write.driver=com.mysql.jdbc.Driver<br>jdbc.write.url=jdbc:mysql://192.168.142.128:3306/mysql_demo<br>jdbc.write.username=root<br>jdbc.write.password=itcast</p>
<p>jdbc.read.driver=com.mysql.jdbc.Driver<br>jdbc.read.url=jdbc:mysql://192.168.142.129:3306/mysql_demo<br>jdbc.read.username=root<br>jdbc.read.password=itcast<br>applicationContext-datasource.xml：</p>
<pre><code class="bash">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xmlns:tx="http://www.springframework.org/schema/tx"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd
        http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd
        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd"&gt;


    &lt;!-- 配置数据源 - Read --&gt;
    &lt;bean id="readDataSource" class="com.mchange.v2.c3p0.ComboPooledDataSource" destroy-method="close"  lazy-init="true"&gt;
        &lt;property name="driverClass" value="${jdbc.read.driver}"&gt;&lt;/property&gt;
        &lt;property name="jdbcUrl" value="${jdbc.read.url}"&gt;&lt;/property&gt;
        &lt;property name="user" value="${jdbc.read.username}"&gt;&lt;/property&gt;
        &lt;property name="password" value="${jdbc.read.password}"&gt;&lt;/property&gt;
    &lt;/bean&gt;


    &lt;!-- 配置数据源 - Write --&gt;
    &lt;bean id="writeDataSource" class="com.mchange.v2.c3p0.ComboPooledDataSource"  destroy-method="close"  lazy-init="true"&gt;
        &lt;property name="driverClass" value="${jdbc.write.driver}"&gt;&lt;/property&gt;
        &lt;property name="jdbcUrl" value="${jdbc.write.url}"&gt;&lt;/property&gt;
        &lt;property name="user" value="${jdbc.write.username}"&gt;&lt;/property&gt;
        &lt;property name="password" value="${jdbc.write.password}"&gt;&lt;/property&gt;
    &lt;/bean&gt;


    &lt;!-- 配置动态分配的读写 数据源 --&gt;
    &lt;bean id="dataSource" class="cn.itcast.aop.datasource.ChooseDataSource" lazy-init="true"&gt;
        &lt;property name="targetDataSources"&gt;
            &lt;map key-type="java.lang.String" value-type="javax.sql.DataSource"&gt;
                &lt;entry key="write" value-ref="writeDataSource"/&gt;
                &lt;entry key="read" value-ref="readDataSource"/&gt;
            &lt;/map&gt;
        &lt;/property&gt;

        &lt;property name="defaultTargetDataSource" ref="writeDataSource"/&gt;

        &lt;property name="methodType"&gt;
            &lt;map key-type="java.lang.String"&gt;
                &lt;entry key="read" value=",get,select,count,list,query,find"/&gt;
                &lt;entry key="write" value=",add,create,update,delete,remove,insert"/&gt;
            &lt;/map&gt;
        &lt;/property&gt;
    &lt;/bean&gt;

&lt;/beans&gt;
</code></pre>
<p>ChooseDataSource：</p>
<pre><code class="bash">public class ChooseDataSource extends AbstractRoutingDataSource {

    public static Map&lt;String, List&lt;String&gt;&gt; METHOD_TYPE_MAP = new HashMap&lt;String, List&lt;String&gt;&gt;();

    /**
     * 实现父类中的抽象方法，获取数据源名称
     * @return
     */
    protected Object determineCurrentLookupKey() {
        return DataSourceHandler.getDataSource();
    }

    // 设置方法名前缀对应的数据源
    public void setMethodType(Map&lt;String, String&gt; map) {
        for (String key : map.keySet()) {
            List&lt;String&gt; v = new ArrayList&lt;String&gt;();
            String[] types = map.get(key).split(",");
            for (String type : types) {
                if (!StringUtils.isEmpty(type)) {
                    v.add(type);
                }
            }
            METHOD_TYPE_MAP.put(key, v);
        }
        System.out.println("METHOD_TYPE_MAP : "+METHOD_TYPE_MAP);
    }
}
</code></pre>
<p>DataSourceHandler：</p>
<pre><code class="bash">public class DataSourceHandler {

    // 数据源名称
    public static final ThreadLocal&lt;String&gt; holder = new ThreadLocal&lt;String&gt;();

    /**
     * 在项目启动的时候将配置的读、写数据源加到holder中
     */
    public static void putDataSource(String datasource) {
        holder.set(datasource);
    }

    /**
     * 从holer中获取数据源字符串
     */
    public static String getDataSource() {
        return holder.get();
    }
}
</code></pre>
<p>DataSourceAspect：</p>
<pre><code class="bash">@Aspect
@Component
@Order(-9999)
@EnableAspectJAutoProxy(proxyTargetClass = true)
public class DataSourceAspect {

    protected Logger logger = LoggerFactory.getLogger(this.getClass());

    /**
     * 配置前置通知,使用在方法aspect()上注册的切入点
     */
    @Before("execution(* cn.itcast.service.*.*(..))")
    @Order(-9999)
    public void before(JoinPoint point) {
        
        String className = point.getTarget().getClass().getName();
        String method = point.getSignature().getName();
        logger.info(className + "." + method + "(" + Arrays.asList(point.getArgs())+ ")");

        try {
            for (String key : ChooseDataSource.METHOD_TYPE_MAP.keySet()) {
                for (String type : ChooseDataSource.METHOD_TYPE_MAP.get(key)) {
                    if (method.startsWith(type)) {
                        System.out.println("key : " + key);
                        DataSourceHandler.putDataSource(key);
                        break;
                    }
                }
            }
        } catch (Exception e) {
            e.printStackTrace();
        }

    }
}
</code></pre>
<p>通过 @Order (-9999) 注解来控制事务管理器，与该通知类的加载顺序，需要让通知类，先加载，来判定使用哪个数据源 。</p>
<p>验证<br>在主库和从库中，执行如下 SQL 语句，来查看是否读的时候， 从从库中读取； 写入操作的时候，是否写入到主库。</p>
<pre><code class="bash">show status like 'Innodb_rows_%' ;
</code></pre>
<p>原理</p>
<p>性能优化 - 应用优化<br>缓存<br>可以在业务系统中使用 redis 来做缓存，缓存一些基础性的数据，来降低关系型数据库的压力，提高访问效率。</p>
<p>全文检索<br>如果业务系统中的数据量比较大（达到千万级别），这个时候，如果再对数据库进行查询，特别是进行分页查询，速度将变得很慢（因为在分页时首先需要 count 求合计数），为了提高访问效率，这个时候，可以考虑加入 Solr 或者 ElasticSearch 全文检索服务，来提高访问效率。</p>
<p>非关系数据库<br>也可以考虑将非核心（重要）数据，存在 MongoDB 中，这样可以提高插入以及查询的效率。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://example.com">阿健君</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2020/10/07/sql/MySQL%20%E9%AB%98%E7%BA%A7%20%E2%80%94%20%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7%E3%80%81%E6%97%A5%E5%BF%97%E3%80%81%E5%A4%8D%E5%88%B6%E3%80%81%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/">http://example.com/2020/10/07/sql/MySQL%20%E9%AB%98%E7%BA%A7%20%E2%80%94%20%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7%E3%80%81%E6%97%A5%E5%BF%97%E3%80%81%E5%A4%8D%E5%88%B6%E3%80%81%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">HJ 的学习录</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/MySQL/">MySQL</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/zhangc233/pic@master/img/mysql2.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/gh/overtrue/share.js@master/dist/js/social-share.min.js" defer=""></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="微信扫码"></a><div class="post-qr-code-desc">微信扫码</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="支付宝扫码"></a><div class="post-qr-code-desc">支付宝扫码</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2020/10/15/jvm/%E5%A0%86/"><img class="prev-cover" src="https://cdn.jsdelivr.net/gh/zhangc233/pic@master/img/2021022018254959.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">堆</div></div></a></div><div class="next-post pull-right"><a href="/2020/10/01/sql/MySQL%20%E9%AB%98%E7%BA%A7%20%E2%80%94%20%E7%B4%A2%E5%BC%95%E3%80%81%E8%A7%86%E5%9B%BE%E3%80%81%E8%A7%A6%E5%8F%91%E5%99%A8/"><img class="next-cover" src="https://cdn.jsdelivr.net/gh/zhangc233/pic@master/img/mysql%E4%BC%98%E5%8C%96.jfif" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">MySQL 高级 — 索引、视图、触发器</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2020/10/01/sql/MySQL%20%E9%AB%98%E7%BA%A7%20%E2%80%94%20%E7%B4%A2%E5%BC%95%E3%80%81%E8%A7%86%E5%9B%BE%E3%80%81%E8%A7%A6%E5%8F%91%E5%99%A8/" title="MySQL 高级 — 索引、视图、触发器"><img class="cover" src="https://cdn.jsdelivr.net/gh/zhangc233/pic@master/img/mysql%E4%BC%98%E5%8C%96.jfif" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-10-01</div><div class="title">MySQL 高级 — 索引、视图、触发器</div></div></a></div><div><a href="/2020/09/28/sql/MySQL%20%E9%AB%98%E7%BA%A7%20%E2%80%94%20%E7%9B%B8%E5%85%B3%E4%BC%98%E5%8C%96%E3%80%81%E9%94%81%E3%80%81%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7/" title="MySQL 高级 — 相关优化、锁、使用技巧"><img class="cover" src="https://cdn.jsdelivr.net/gh/junian455/pic@master/img/mysql%E4%BC%98%E5%8C%96.jfif" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-09-28</div><div class="title">MySQL 高级 — 相关优化、锁、使用技巧</div></div></a></div></div></div><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div><div id="comment-switch"><span class="first-comment">Valine</span><span class="switch-btn"></span><span class="second-comment">Disqus</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div><div><div id="disqus_thread"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"></div><div class="author-info__name">阿健君</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">64</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">108</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">23</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>qq:1064821280</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/junian455" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="/1064821280@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://junian455.github.io/" target="_blank" title="Blog"><i class="fas fa-rss-square"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">哈喽，有问题的话请在留言板留言，我看到会第一时间回复你。</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AF%A5%E5%8F%82%E6%95%B0%E7%94%A8%E6%9D%A5%E6%8E%A7%E5%88%B6%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97%E6%98%AF%E5%90%A6%E5%BC%80%E5%90%AF%EF%BC%8C-%E5%8F%AF%E5%8F%96%E5%80%BC%EF%BC%9A-1-%E5%92%8C-0-%EF%BC%8C-1-%E4%BB%A3%E8%A1%A8%E5%BC%80%E5%90%AF%EF%BC%8C-0-%E4%BB%A3%E8%A1%A8%E5%85%B3%E9%97%AD"><span class="toc-text">该参数用来控制慢查询日志是否开启， 可取值： 1 和 0 ， 1 代表开启， 0 代表关闭</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AF%A5%E5%8F%82%E6%95%B0%E7%94%A8%E6%9D%A5%E6%8C%87%E5%AE%9A%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97%E7%9A%84%E6%96%87%E4%BB%B6%E5%90%8D"><span class="toc-text">该参数用来指定慢查询日志的文件名</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AF%A5%E9%80%89%E9%A1%B9%E7%94%A8%E6%9D%A5%E9%85%8D%E7%BD%AE%E6%9F%A5%E8%AF%A2%E7%9A%84%E6%97%B6%E9%97%B4%E9%99%90%E5%88%B6%EF%BC%8C-%E8%B6%85%E8%BF%87%E8%BF%99%E4%B8%AA%E6%97%B6%E9%97%B4%E5%B0%86%E8%AE%A4%E4%B8%BA%E5%80%BC%E6%85%A2%E6%9F%A5%E8%AF%A2%EF%BC%8C-%E5%B0%86%E9%9C%80%E8%A6%81%E8%BF%9B%E8%A1%8C%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95%EF%BC%8C-%E9%BB%98%E8%AE%A410s"><span class="toc-text">该选项用来配置查询的时间限制， 超过这个时间将认为值慢查询， 将需要进行日志记录， 默认10s</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%98%E5%8C%96-limit"><span class="toc-text">优化 limit</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96-%E7%B4%A2%E5%BC%95"><span class="toc-text">性能优化 - 索引</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/04/16/collection/%E7%BA%A2%E9%BB%91%E6%A0%91%E5%8E%9F%E7%90%86/" title="红黑树原理"><img src="https://cdn.jsdelivr.net/gh/zhangc233/pic@master/img/%E7%BA%A2%E9%BB%912%E6%A0%91.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="红黑树原理"></a><div class="content"><a class="title" href="/2022/04/16/collection/%E7%BA%A2%E9%BB%91%E6%A0%91%E5%8E%9F%E7%90%86/" title="红黑树原理">红黑树原理</a><time datetime="2022-04-16T02:55:00.000Z" title="发表于 2022-04-16 10:55:00">2022-04-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/04/02/design/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E8%A1%8C%E4%B8%BA%E5%9E%8B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" title="设计模式-行为型设计模式"><img src="https://cdn.jsdelivr.net/gh/junian455/pic@master/img/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="设计模式-行为型设计模式"></a><div class="content"><a class="title" href="/2022/04/02/design/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E8%A1%8C%E4%B8%BA%E5%9E%8B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" title="设计模式-行为型设计模式">设计模式-行为型设计模式</a><time datetime="2022-04-02T08:11:00.000Z" title="发表于 2022-04-02 16:11:00">2022-04-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/03/14/redis/%E6%80%8E%E4%B9%88%E5%88%A9%E7%94%A8Redis%E5%AE%9E%E7%8E%B0%E6%95%B0%E6%8D%AE%E7%9A%84%E5%8E%BB%E9%87%8D%EF%BC%9F/" title="怎么利用Redis实现数据的去重？"><img src="https://cdn.jsdelivr.net/gh/junian455/pic@master/img/cache.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="怎么利用Redis实现数据的去重？"></a><div class="content"><a class="title" href="/2022/03/14/redis/%E6%80%8E%E4%B9%88%E5%88%A9%E7%94%A8Redis%E5%AE%9E%E7%8E%B0%E6%95%B0%E6%8D%AE%E7%9A%84%E5%8E%BB%E9%87%8D%EF%BC%9F/" title="怎么利用Redis实现数据的去重？">怎么利用Redis实现数据的去重？</a><time datetime="2022-03-14T06:29:00.000Z" title="发表于 2022-03-14 14:29:00">2022-03-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/03/01/sql/select%EF%BC%8A%E5%92%8C%20select%20%E5%85%A8%E9%83%A8%E5%AD%97%E6%AE%B5%EF%BC%8C%E5%AE%83%E4%BB%AC%E7%9A%84%E5%8C%BA%E5%88%AB%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F/" title="select＊和 select 全部字段，它们的区别是什么？"><img src="https://cdn.jsdelivr.net/gh/junian455/pic@master/img/es1.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="select＊和 select 全部字段，它们的区别是什么？"></a><div class="content"><a class="title" href="/2022/03/01/sql/select%EF%BC%8A%E5%92%8C%20select%20%E5%85%A8%E9%83%A8%E5%AD%97%E6%AE%B5%EF%BC%8C%E5%AE%83%E4%BB%AC%E7%9A%84%E5%8C%BA%E5%88%AB%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F/" title="select＊和 select 全部字段，它们的区别是什么？">select＊和 select 全部字段，它们的区别是什么？</a><time datetime="2022-03-01T02:55:00.000Z" title="发表于 2022-03-01 10:55:00">2022-03-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/01/20/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/SEATA/" title="SEATA"><img src="https://cdn.jsdelivr.net/gh/junian455/pic@master/img/seata.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SEATA"></a><div class="content"><a class="title" href="/2022/01/20/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/SEATA/" title="SEATA">SEATA</a><time datetime="2022-01-20T07:11:00.000Z" title="发表于 2022-01-20 15:11:00">2022-01-20</time></div></div></div></div></div></div></main><footer id="footer" style="background: transparent"><div id="footer-wrap"><div class="copyright">©2020 - 2022 By 阿健君</div><div class="footer_custom_text"><span style="margin-top:5px;display:inline-block;font-weight:bold;font-size:14px">一分耕耘，一分收获。</span><p></p> <p><a target="_blank" href="https://hexo.io/"><img src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&amp;logo=hexo" title="博客框架为Hexo" data-ll-status="loading" class="entered loading"></a>&nbsp;<a target="_blank" href="https://demo.jerryc.me/"><img src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&amp;logo=bitdefender" title="主题采用butterfly" data-ll-status="loading" class="entered loading"></a>&nbsp;<a target="_blank" href="https://metroui.org.ua/index.html "><img src="https://img.shields.io/badge/CDN-jsDelivr-orange?style=flat&amp;logo=jsDelivr" title="本站使用JsDelivr为静态资源提供CDN加速" data-ll-status="loading" class="entered loading"></a> &nbsp;<a target="_blank" href="https://vercel.com/ "><img src="https://img.shields.io/badge/Hosted-Vervel-brightgreen?style=flat&amp;logo=Vercel" title="本站采用双线部署，默认线路托管于Vercel" data-ll-status="loading" class="entered loading"></a>&nbsp;<a class="github-badge" target="_blank" href="https://beian.miit.gov.cn" style="margin-inline:5px" title="本站已在工信部备案，备案号浙ICP备-2022001668号"><img src="http://cdn.ymktchic.top/img/202201212329189.svg" data-lazy-src="" alt="" data-ll-status="loaded" class="entered loaded"></a>&nbsp;<a target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&amp;logo=Claris" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可" data-ll-status="loading" class="entered loading"></a> <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="95" height="20" role="img" aria-label="CDN:又拍云"><title>CDN:又拍云</title><linearGradient id="s" x2="0" y2="100%"><stop offset="0" stop-color="#bbb" stop-opacity=".1"></stop><stop offset="1" stop-opacity=".1"></stop></linearGradient><clipPath id="r"><rect width="95" height="20" rx="3" fill="#fff"></rect></clipPath><g clip-path="url(#r)"><rect width="52" height="20" fill="#555"></rect><rect x="52" width="43" height="20" fill="#00b6ff"></rect><rect width="95" height="20" fill="url(#s)"></rect></g><g fill="#fff" text-anchor="middle" font-family="Verdana,Geneva,DejaVu Sans,sans-serif" text-rendering="geometricPrecision" font-size="110"><image x="5" y="3" width="14" height="14" xlink:href="https://developer.qiniu.com/assets/logo-white-b90d685a6b146884636382426d11b7236f5f7ca1c5dfafdb6fa777a0f976fc1f.png"></image><text aria-hidden="true" x="355" y="150" fill="#010101" fill-opacity=".3" transform="scale(.1)" textLength="250">CDN</text><text x="355" y="140" transform="scale(.1)" fill="#fff" textLength="250">CDN</text><text aria-hidden="true" x="725" y="150" fill="#010101" fill-opacity=".3" transform="scale(.1)" textLength="330">七牛云</text><text x="725" y="140" transform="scale(.1)" fill="#fff" textLength="330">七牛云</text></g></svg></p></div></div><div class="container" id="jsi-flying-fish-container"></div><style>@media only screen and (max-width: 767px){
  #sidebar_search_box input[type=text]{width:calc(100% - 24px)}
}</style></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="聊天"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">本地搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div><hr><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '',
      appKey: '',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script><script>function loadDisqus () {
  var disqus_config = function () {
    this.page.url = 'http://example.com/2020/10/07/sql/MySQL%20%E9%AB%98%E7%BA%A7%20%E2%80%94%20%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7%E3%80%81%E6%97%A5%E5%BF%97%E3%80%81%E5%A4%8D%E5%88%B6%E3%80%81%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/'
    this.page.identifier = '2020/10/07/sql/MySQL 高级 — 常用工具、日志、复制、综合案例/'
    this.page.title = 'MySQL 高级 — 常用工具、日志、复制、综合案例'
  };

  window.disqusReset = () => {
    DISQUS.reset({
      reload: true,
      config: disqus_config
    })
  }

  if (window.DISQUS) disqusReset()
  else {
    (function() { 
      var d = document, s = d.createElement('script');
      s.src = 'https://.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  }
}

if ('Valine' === 'Disqus' || !true) {
  if (true) btf.loadComment(document.getElementById('disqus_thread'), loadDisqus)
  else loadDisqus()
} else {
  function loadOtherComment () {
    loadDisqus()
  }
}
</script></div><script src="/js/card_categor_hide.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script data-pjax="" src="https://cdn.jsdelivr.net/gh/Jnylife/CDN@1.3/js/fish.js"></script><script src="https://cdn.jsdelivr.net/gh/sviptzk/HexoStaticFile@latest/Hexo/js/WithoutLine.min.js"></script><div class="aplayer no-destroy" data-id="60198" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay="true"> </div><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-heart.min.js" async="async" mobile="false"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer@1/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script><script async="" data-pjax="" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>